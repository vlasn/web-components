<template id="score-board">
  <div class="score-board">
    <div class="char"></div>
    <h2>üéÆGame #<span id="game">0</span></h2>
    <div class="score-fileds">
      <div class="field">
        <strong>üí∞Gold</strong>
        <span id="gold">0</span>
      </div>
      <div class="field">
        <strong>‚ù§Ô∏èLife</strong>
        <span id="life">0</span>
      </div>
      <div class="field">
        <strong>üèÜScore</strong>
        <span id="score">0</span>
      </div>
      <div class="field">
        <strong>üìåTurn</strong>
        <span id="turn">0</span>
      </div>
    </div>
  </div>
</template>

<style>
  .score-board {
    position: fixed;
    top: 20px;
    left: 20px;
    background: #fff;
    border: 1px solid silver;
    border-radius: 20px;
    padding: 20px 30px;
  }
  .char {
    border-radius: 50%;
    height: 150px;
    width: 150px;
    background: url(scoreboard/img/toothless.png) no-repeat #8646c5;
    background-size: cover;
    background-position: center center;
  }
  h2 {
    margin: 0 0 20px 0;
    border-bottom: 2px dotted;
  }
  .score-fields {

  }
  .field {
    background: #000;
    margin: 5px 0;
    color: #fff;
    padding: 5px 10px;
    border-radius: 10px;
    line-height: 30px;
  }
  .field strong, .field span {
    display: inline-block;
    vertical-align: middle;
  }
  .field span {
    float:right;
  }

</style>

<script>
  class Scoreboard extends HTMLElement {
    constructor () {
      super ();
      const importDoc = document.currentScript.ownerDocument;
      this.attachShadow({mode: 'open'});
      // As we attached a shadowroot to `this` directly, we don't need to keep a reference to shadowRoot
      // in a separate variable and have access to it via `this`
      this.shadowRoot.appendChild(importDoc.querySelector('style'));
      const content = importDoc.querySelector('template#score-board').content;
      this.shadowRoot.appendChild(content);
      this.updateState({
        data: [
          {score: 0},
          {gold: 0},
          {lives: 3},
          {turns: 0}
        ]
      });
    }

    updateState(event) {
      console.log('event:', event);
      const scoreboardData = event.detail.data;
      this.setGameId(window.game.gameId || '0000');
      this.setScore(scoreboardData.score || '0');
      this.setGold(scoreboardData.gold || '0');
      this.setLives(scoreboardData.lives || '0');
      this.setTurns(scoreboardData.turns || '0');
    }

    connectedCallback() {
      console.log('Component has been initialized!');
      this.shopListener = window.addEventListener('shopEvent', e => {
        console.log('shopEvent:', e);
        this.updateState(e);
        // this.setAttribute('count', (parseInt(this.getAttribute('count'))+ 1) || 0);
      });
      this.solveListener = window.addEventListener('solveEvent', e => {
        console.log('solveEvent:', e);
        this.updateState(e);
      });
    }

    disconnectedCallback() {
      this.shopListener.removeEventListener('shopEvent');
      this.solveListener.removeEventListener('solveEvent');
    }

    setGameId(gameId) {
      this.shadowRoot.getElementById('game').innerHTML = gameId;
    }

    setGold(gold) {
      this.shadowRoot.getElementById('score').innerHTML = gold;
    }

    setLives(lives) {
      this.shadowRoot.getElementById('life').innerHTML = lives;
    }

    setScore(score) {
      this.shadowRoot.getElementById('score').innerHTML = score;
    }

    setTurns(turns) {
      this.shadowRoot.getElementById('turn').innerHTML = turns;
    }
  }
  window.customElements.define('game-scoreboard', Scoreboard);
</script>